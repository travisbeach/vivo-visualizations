  <html>
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> 
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/list.js"></script>
    <script src="js/nouislider.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/nouislider.min.css">
    <link rel="stylesheet" type="text/css" href="css/newStyle.css">  
  </head>
  <body>
    <div class="row">
      <div class="col-md-3">
        <div class="panel-group" id="accordion">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                  <span class="start">Filter by:</span> Person
                </a>
              </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse">
              <div class="panel-body" id="person">

              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                 <span class="start">Filter by:</span> Department
               </a>
             </h4>
           </div>
           <div id="collapseTwo" class="panel-collapse collapse">
            <div class="panel-body" id="department">

            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                <span class="start">Filter by:</span> Active Year
              </a>
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse">
            <div class="panel-body" id="date">
              <div id="range"></div>
            </div>
          </div>
        </div>
      </div>
      </div>
      <div class="col-md-9">
        <div id="canvas">
        </div>
      </div>
    </div>
    <script>
     var width=500; 
     var height = 500;
     var bleed = 0;
    //store global copy of grants for debugging.
    var grants; 

    var pack = d3.layout.pack()
    .sort(null)
    .size([width, height])
    .padding(2);

    d3.json("data/fake_grants_data.json", function(data){
      grants = data;
      
      //
      var people = getProperty(grants, "Person"); 
      addList("#person", people); 

      var departments = getProperty(grants, "Department"); 
      addList("#department", departments);

      var minYear = d3.min(grants, d=>d.Start); 
      console.log(minYear);
      var maxYear = d3.max(grants, d=>d.End); 
      console.log(maxYear); 

      var range = document.getElementById('range');
      noUiSlider.create(range, {
          start: [ minYear, maxYear], // Handle start position
          margin: 1, // Handles must be more than '20' apart
          connect: true, // Display a colored bar between the handles
          step: 1, 
          tooltips: true,
          format: {
            to: function ( value ) {
              return value;
            },
            from: function ( value ) {
              return value;
            }}, 
          range: { // Slider can select '0' to '100'
          'min': minYear,
          'max': maxYear
        }, 
        pips: {
          mode: 'values',
          values: [minYear, maxYear],
          density: 5
        }
      });


      var svg = d3.select("#canvas").append("svg")
            .attr("height", height)
            .attr("width", width); 


      var node = svg.selectAll(".node")
      .data(pack.nodes(gymnastics(grants))
        .filter(function(d) { return !d.children; }))
      .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

      node.append("circle")
      .attr("r", function(d) { return d.r; });

      node.append("text")
      .text(function(d) { return d.r > 6 ? d.Cost : '' })
      .style("font-size", function(d) { return Math.min(2 * d.r, (2 * d.r - 8) / this.getComputedTextLength() * 24) + "px"; })
      .attr("dy", ".35em");


  // rebind data
    svg.data(pack.nodes(gymnastics(dropSome(grants)))).selectAll(".node")
      .data(pack.nodes);





    });

//Formats data array to inlude name and value fields; 
    function gymnastics(array){
      var nodes = array.map(function(d){
        d['name'] = d.Title; 
        d['value'] = d.Cost; 
        d['test'] = 1; 
        return d; 
      }); 
      return {children: nodes}; 
    }

    function dropSome(array){
      return array.filter(d=>Math.random()>.5); 
    }

  </script>

</body>
</html>